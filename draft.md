# 4.draft

Оболочки: bash,zsh,fish  
Справка:  type,help,man,apropos,whatis,info  

#### Hot keys:  
![alt-текст](https://github.com/dbudakov/4.bash/blob/master/image/moving_bash.png)  
#### move and copy/past
Ctrl+a Ctrl+e - home,end  
Alt+f Alt+b - forward, back  
Ctrl+w - cut to cursor  
Ctrl+y - paste  
Ctrl+u - del string to cursor  
Ctrl+k - del string after cursor  
#### function
Tab или Ctrl+1 - tabulation  
Ctrl+j - Enter  
Ctrl+l - clear  
Ctrl + r - поиск по строке, повторный Ctrl + r - цикличный поиск по истории  
Ctrl + r дважды - поиск по последней поисковой строке  
  Во время поиска:  
  Ctrl + j - закончить поиск по истории  
  Ctrl + g - закончить поиск и вернуть строку к прежнему состоянию  
Crtl + /  
Сtrl + e  


#### Перенаправления
1 [file]<< EOF / EOF    
2 cat << EOF > myscript.sh  
3 read first second <<< "hello world"   
### Scripts
#### варианты запуска  
1 ./script.sh (необходим chmod +x)  
2 bash script.sh  
3 source script.sh  
### Переменные  
1 env  
2 printenv  
3 export  
4 declare  
##### Специальные переменные:
 $@ — параметры скрипта (столбик)  
 $* - все параметры скрипта (строка)  
 $0 — имя скрипта  
 $# — количество параметров  
 $? — статус выхода последней вýполненной командý  
 $$ — PID оболочки  
 $! — PID последней вýполненной в фоновом режиме командý  
##### примеры:  
export var=value  
declare var=value  
var=$(expr 3 + 7)  
var1="${var1:-default value}"  

### Arrays  
files = $(ls) - считýваетсā строка  
array=('first element' 'second element' 'third element')  
array=([3]='fourth element' [4]='fifth element')  
array[0]='first element'  
array[1]='second element'  
echo ${array[2]}  
IFS=$'\n'; echo "${array[*]}"  
declare -A array  
array[first]='First element'  
array[second]='Second element'  
array =(0 1 2)  

### Управляющие структуры
####  Условные операторы
##### Оператор варианта case синтаксис:  
`case значени in  
[шаблон].) список1;;  
шаблон2 I шаблонЗ) список2;; ]  
esac  `  
Ищется первый шаблон, совпадающий с значением. Если он найден, то выполняется соответствующий ему список команд, завершенный двумя символами «;». Шаблон и список разделяются символом «)». Одному списку команд может соответствовать несколько шаблонов, тогда они разделяются символом «|».  

##### Условны операто if синтаксис:  
`if список1 ;then  
список2;  
[elif список then  
список4];   
[else  
список5];  
fi;`  
Сначала выполняются команды из списка1. Если этот список выполнен успешно, то есть с кодом завершения 0, то выполняется список2, если нет список, стоящий после очередного elif. При невозможности выполнить список команд, стоящий после очередного then, выполняется список, стоящий после else. Можно использовать сокращенный вариант, только if-then-fi.    
##### Оператор test и условные выражения  
`test -e <файл>     
или  
[ -e <файл> ]`  
`[` — это название команды, а `]` — обязательный последний аргумент этой команды 
``` 
[ -e FILE ] — файл существует  
[ -d FILE ] — это директория  
[ -f FILE ] — это обычный файл  
[ -s FILE ] — размер ненулевой  
[ -r FILE ] — доступен длā чтения  
[ -w FILE ] — доступен для записи  
[ -x FILE ] — исполняемый  
```    
####  Операторы цикла  
##### Оператор цикла с перечислением for:  
`for переменная [in шаблон];  
do  
список;   
done;`
Переменная получает значение первого слова из этого шаблона(списка через пробел), и выполняется список команд, стоящий между do и done. Затем переменная получает значение очередного слова и списка слов, и сново выполняется список команд.  

##### Операто цикл с условие while  
`while список1;  
do  
список2;  
done;`  
Оператор выполняет список1 и в случае его успешного завершения(нулевого кода возврата) — список2. Процедура повторяется до тех пор, пока результ выполнения списка1 не станет ненулевым.   

##### Оператор цикла с инверсным условием until  
`until список1;  
do  
список2;  
done;`  
Оператор выполняет список1 и, если он выполнен неуспешно(код возврата ненулевой), то выполняет список2. Процедура повторяется до тех пор, пока результат выполнения списка1 не станет нулевым.  
##### Операто цикл с выборо select  
`select переменная [in шаблон];  
do  
список;   
done;`   
В результате подстановки шаблона получается список слов. К этим словам оператор добавляет порядковый номер и выводит весь набор в стандартный поток ошибок (stderr).    

[Колисниченко, Аллен: Linux полное руководство](https://proweb.md/ftp/carti/%D0%9A%D0%BE%D0%BB%D0%B8%D1%81%D0%BD%D0%B8%D1%87%D0%B5%D0%BD%D0%BA%D0%BE%20%D0%94%D0%9D%20%20%D0%90%D0%BB%D0%BB%D0%B5%D0%BD%20%D0%9F%D0%B8%D1%82%D0%B5%D1%80%20%D0%92%20Linux%20%D0%BF%D0%BE%D0%BB%D0%BD%D0%BE%D0%B5%20%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D1%81%D1%82%D0%B2%D0%BE.pdf) Глава 8.  


Условия для строк и чисел
```
-z # строка пуста  
-n # строка не пуста  
=, (==) # строки равны  
!= # строки не равны  
-eq # равно  
-ne # не равно  
-lt,(< ) # меньше  
-le,(<=) # меньше или равно  
-gt,(>) # больше  
-ge,(>=) # больше или равно  
 ! # отрицание логического вýражениā  
-a,(&&) # логическое «И»  
-o,(||) # логическое «ИЛИ»  
```












скрипт киди
mandb - update db
сочетание клавиш
  
  bash-completion
  ctrl /

/ - в конце строки дополнение строки
&& - выполнить первую команду И выпонить вторую команду
|| - выполнить первую команду ИЛИ вторую

команды trur/false - вывод 1 или 0
echo $? - указывает кол-во ошибок

google > bash error code

ls -l /dev/std* - потоки

echo $TERM
 alias |grep color 
 
mkfifo

<<EOF - end of file


bash /script
bash -x   для отладки
ещё pipestatus[i] полезно знать 

evn - много инфы, переменные
printenv
записть в .bash_profile, экспортных переменных

IFS - array знак переноса

https://devhints.io/bash#conditionals - шпора

while: exit 0 - не кашерный выход?
## ДЗ
while [ -f $pid_file ]
    do
      echo "Идет фоновой процесс ждем 300 секунд"
      sleep 300
  done
  вот защита от повторного запуска
  ### lock file во временное хранилище - tmp,var
  
   https://regex101.com/
  
  awk -F\' '$1=="menuentry " {print $2}' /etc/grub2.cfg
  sed '/ *#/d; /^ *$/d'
  egrep "^#|^$"
  
 классы
 
tr --help - замена 
echo "hello \thonny" \t - табуляция 
awk -F":" -f ./test.awk /etc/passwd

sed - steam editior, замена данных на ходу
secoban на sed - игра  http://sed.sourceforge.net/local/games/sokoban.sed.html
